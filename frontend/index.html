<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' http://127.0.0.1:* ws://127.0.0.1:*; img-src 'self' data: file: http://127.0.0.1:*; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; media-src 'self' blob: http://127.0.0.1:*;">
  <title>ãµã«ã‚ƒç§˜æ›¸ãŸã‚“</title>
  <link rel="stylesheet" href="./styles.css">
  <style>
    /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ« */

    /* æ“ä½œãƒ¢ãƒ¼ãƒ‰é€šçŸ¥ */
    .pointer-events-enabled:after {
      content: "æ“ä½œãƒ¢ãƒ¼ãƒ‰";
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: rgba(255, 0, 0, 0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 9999;
      pointer-events: none;
    }

    /* ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .drag-mode-enabled .assistant-image {
      opacity: 0.8 !important;
      cursor: grab !important;
      pointer-events: auto !important;
    }
    
    .drag-mode-enabled .assistant-image:active {
      cursor: grabbing !important;
    }
    
    /* ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰é€šçŸ¥ */
    .drag-mode-enabled:after {
      content: "ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰";
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: rgba(255, 165, 0, 0.8);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 9999;
      pointer-events: none;
    }

    /* ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .drag-button {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 40px;
      height: 40px;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      z-index: 9999;
      font-size: 18px;
      pointer-events: auto;
      transition: all 0.2s ease;
    }
    
    .drag-button:hover {
      transform: scale(1.1);
      background-color: rgba(255, 240, 245, 0.9);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    /* ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .drag-mode-enabled .drag-button {
      background-color: rgba(255, 165, 0, 0.8);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
    const CONFIG = {
      voicevox: {
        host: 'http://127.0.0.1:50021',
        speaker_id: 8
      },
      backend: {
        host: 'http://127.0.0.1:8000',
        ws_url: 'ws://127.0.0.1:8000/ws'
      }
    };
    
    // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ•ã‚§ãƒƒãƒãƒ©ãƒƒãƒ‘ãƒ¼
    async function debugFetch(url, options) {
      console.log(`[DEBUG] Fetché–‹å§‹: ${url}`, options);
      try {
        const response = await fetch(url, options);
        console.log(`[DEBUG] Fetchå®Œäº† (${Date.now() - performance.now()}ms): ${url}`);
        return response;
      } catch (error) {
        console.log(`[DEBUG] Fetchã‚¨ãƒ©ãƒ¼ (${Date.now() - performance.now()}ms): ${url}`, error);
        throw error;
      }
    }
    
    // æ—¢å­˜ã®fetchã‚’ãƒ©ãƒƒãƒ—ã—ãªã„ï¼ˆrenderer.jsã®å®Ÿè£…ã‚’ä½¿ã†ï¼‰
    window.originalFetch = window.fetch;
    
    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤é–¢é€£ã®è¨­å®šã¨æ“ä½œ
    let currentSettings = {
      opacity: 100,
      size: 100,
      position: 'bottomRight',
      autoHide: true,
      alwaysOnTop: true
    };
    
    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
    function toggleOverlayMenu() {
      const menu = document.getElementById('overlayMenu');
      if (menu.style.display === 'none') {
        menu.style.display = 'block';
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºæ™‚ã¯ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚’æœ‰åŠ¹ã«
        if (window.electronAPI && window.electronAPI.enableMouseEvents) {
          window.electronAPI.enableMouseEvents();
        }
        // ç¾åœ¨ã®è¨­å®šå€¤ã‚’UIã«åæ˜ 
        loadCurrentSettings();
        
        // è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã‚’å¼·èª¿è¡¨ç¤º
        const settingsIcon = document.getElementById('settingsIcon');
        if (settingsIcon) {
          settingsIcon.style.opacity = '1';
          settingsIcon.style.transform = 'rotate(45deg)';
          settingsIcon.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
        }
      } else {
        menu.style.display = 'none';
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼éè¡¨ç¤ºæ™‚ã¯ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€éã«
        if (window.electronAPI && window.electronAPI.disableMouseEvents) {
          window.electronAPI.disableMouseEvents();
        }
        
        // è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã‚’å…ƒã«æˆ»ã™
        const settingsIcon = document.getElementById('settingsIcon');
        if (settingsIcon) {
          settingsIcon.style.opacity = '0.3';
          settingsIcon.style.transform = '';
          settingsIcon.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
        }
      }
    }
    
    // ç¾åœ¨ã®è¨­å®šã‚’UIã«åæ˜ 
    function loadCurrentSettings() {
      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã‚’è¨­å®š
      document.getElementById('opacitySlider').value = currentSettings.opacity;
      document.getElementById('opacityValue').textContent = currentSettings.opacity;
      
      document.getElementById('sizeSlider').value = currentSettings.size;
      document.getElementById('sizeValue').textContent = currentSettings.size;
      
      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’è¨­å®š
      document.getElementById('autoHideToggle').checked = currentSettings.autoHide;
      document.getElementById('alwaysTopToggle').checked = currentSettings.alwaysOnTop;
    }
    
    // é€æ˜åº¦ã®æ›´æ–°
    function updateOpacity(value) {
      document.getElementById('opacityValue').textContent = value;
      currentSettings.opacity = parseInt(value);
      
      // å®Ÿéš›ã®ã‚¹ã‚¿ã‚¤ãƒ«ã«é©ç”¨
      const assistantImage = document.getElementById('assistantImage');
      if (assistantImage) {
        assistantImage.style.opacity = value / 100;
      }
    }
    
    // ã‚µã‚¤ã‚ºã®æ›´æ–°
    function updateSize(value) {
      document.getElementById('sizeValue').textContent = value;
      currentSettings.size = parseInt(value);
      
      // å®Ÿéš›ã®ã‚¹ã‚¿ã‚¤ãƒ«ã«é©ç”¨
      const assistantImage = document.getElementById('assistantImage');
      if (assistantImage) {
        assistantImage.style.transform = `scale(${value / 100})`;
      }
    }
    
    // ä½ç½®ã®æ›´æ–°
    function updatePosition(position) {
      currentSettings.position = position;
      
      const container = document.querySelector('.assistant-container');
      if (!container) return;
      
      // ä½ç½®ã«å¿œã˜ã¦ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´
      switch (position) {
        case 'topLeft':
          container.style.alignItems = 'flex-start';
          container.style.justifyContent = 'flex-start';
          container.style.paddingRight = '0';
          container.style.paddingLeft = '30px';
          break;
        case 'topRight':
          container.style.alignItems = 'flex-end';
          container.style.justifyContent = 'flex-start';
          container.style.paddingRight = '30px';
          container.style.paddingLeft = '0';
          break;
        case 'bottomLeft':
          container.style.alignItems = 'flex-start';
          container.style.justifyContent = 'flex-end';
          container.style.paddingRight = '0';
          container.style.paddingLeft = '30px';
          break;
        case 'bottomRight':
        default:
          container.style.alignItems = 'flex-end';
          container.style.justifyContent = 'flex-end';
          container.style.paddingRight = '30px';
          container.style.paddingLeft = '0';
          break;
      }
      
      // ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’æ›´æ–°
      const positionButtons = document.querySelectorAll('.position-buttons button');
      if (positionButtons.length === 4) {
        // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
        positionButtons.forEach(btn => btn.classList.remove('active'));
        
        // é¸æŠã•ã‚ŒãŸãƒã‚¸ã‚·ãƒ§ãƒ³ã«åˆã‚ã›ã¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
        let activeIndex = 0;
        switch (position) {
          case 'topLeft': activeIndex = 0; break;
          case 'topRight': activeIndex = 1; break;
          case 'bottomLeft': activeIndex = 2; break;
          case 'bottomRight': activeIndex = 3; break;
        }
        positionButtons[activeIndex].classList.add('active');
      }
    }
    
    // è‡ªå‹•é€æ˜åŒ–ã®è¨­å®š
    function toggleAutoHide(enabled) {
      currentSettings.autoHide = enabled;
      
      // ã‚¯ãƒ©ã‚¹åˆ‡ã‚Šæ›¿ãˆã§è‡ªå‹•é€æ˜åŒ–ã‚’åˆ¶å¾¡
      if (!enabled) {
        document.body.classList.remove('mouse-active');
      }
    }
    
    // æœ€å‰é¢è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
    function toggleAlwaysOnTop(enabled) {
      currentSettings.alwaysOnTop = enabled;
      
      // Electron APIã‚’ä½¿ç”¨ã—ã¦è¨­å®š
      if (window.electronAPI && window.electronAPI.toggleAlwaysOnTop) {
        window.electronAPI.toggleAlwaysOnTop();
      }
    }
    
    // è¨­å®šã‚’ä¿å­˜
    function saveSettings() {
      if (window.electronAPI && window.electronAPI.updateSettings) {
        window.electronAPI.updateSettings({
          assistant: currentSettings
        }).then(() => {
          // ä¿å­˜æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
          console.log('è¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ');
          // ç°¡æ˜“çš„ãªæˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
          const saveBtn = document.querySelector('.overlay-footer button');
          if (saveBtn) {
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'âœ“ ä¿å­˜å®Œäº†';
            saveBtn.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
              saveBtn.textContent = originalText;
              saveBtn.style.backgroundColor = '';
            }, 2000);
          }
        });
      }
      
      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
      toggleOverlayMenu();
    }
    
    // å¹ãå‡ºã—ã‚’éè¡¨ç¤ºã«ã™ã‚‹é–¢æ•°
    function hideBubble() {
      const speechBubble = document.getElementById('speechBubble');
      if (speechBubble) {
        // å¹ãå‡ºã—ã‚’éè¡¨ç¤ºã«ã™ã‚‹
        speechBubble.className = 'speech-bubble hide';
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ã¾ã§å°‘ã—å¾…ã£ã¦ã‹ã‚‰å®Œå…¨ã«éè¡¨ç¤º
        setTimeout(() => {
          speechBubble.style.display = 'none';
          speechBubble.style.visibility = 'hidden';
          speechBubble.style.opacity = '0';
        }, 300);
        
        // å†ç”Ÿä¸­ã®ã™ã¹ã¦ã®éŸ³å£°ã‚’åœæ­¢ã™ã‚‹
        document.querySelectorAll('audio').forEach(audio => {
          audio.pause();
          audio.currentTime = 0;
        });
        
        // å£ãƒ‘ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢ï¼ˆã‚‚ã—å¤–éƒ¨é–¢æ•°ãŒã‚ã‚Œã°ï¼‰
        if (typeof stopTalking === 'function') {
          stopTalking();
        }
      }
    }
    
    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã™ã‚‹é–¢æ•°
    function closeApp() {
      if (window.electronAPI && window.electronAPI.closeWindow) {
        window.electronAPI.closeWindow();
      }
    }
  </script>
</head>
<body>
  <div id="app">
    <div class="assistant-container">
      <div class="speech-bubble" id="speechBubble">
        <span class="bubble-icon">ğŸ’­</span>
        <span class="bubble-text" id="speechText"></span>
        <div class="bubble-close-button" id="bubbleCloseButton" onclick="hideBubble()">Ã—</div>
      </div>
      <img id="assistantImage" class="assistant-image" src="../assets/images/secretary_normal.png" alt="ç§˜æ›¸ãŸã‚“" />
      <div class="close-button" id="closeButton" onclick="closeApp()">Ã—</div>
      
      <!-- ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ -->
      <div class="drag-button" id="dragButton" onclick="toggleDragMode()" title="ç§˜æ›¸ãŸã‚“ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ãã‚‹ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ (Ctrl+Shift+P)">
        <span>ğŸ¾</span>
      </div>
    </div>
    <div class="error-bubble" id="errorBubble">
      <span class="bubble-icon">âš ï¸</span>
      <span class="bubble-text" id="errorText"></span>
    </div>
    <div id="statusIndicator" class="status-indicator"></div>
    
    <!-- ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    <div class="settings-icon" id="settingsIcon" onclick="toggleOverlayMenu()">âš™ï¸</div>
    <div class="debug-controls" id="debugMenu" style="display: none;">
      <button id="normalBubbleBtn" onclick="testNormalBubble()">é€šå¸¸å¹ãå‡ºã—</button>
      <button id="testBubbleBtn" onclick="testBubble()">èµ¤å¹ãå‡ºã—</button>
      <button id="randomLineBtn" onclick="testRandomLine()">ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•</button>
      <button id="testZombieBtn" onclick="testZombieOverlay()">ã‚¾ãƒ³ãƒ“æ¤œå‡ºãƒ†ã‚¹ãƒˆ</button>
      <button id="toggleClickThroughBtn" onclick="toggleClickThroughMode()">æ“ä½œãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿</button>
      <button id="devToolsBtn" onclick="openDevTools()">é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«</button>
      <button id="closeMenuBtn" onclick="toggleDebugMenu()">é–‰ã˜ã‚‹</button>
    </div>
    
    <!-- ã‚²ãƒ¼ãƒ å†…ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="overlay-menu" id="overlayMenu" style="display: none;">
      <div class="overlay-header">
        <span>ç§˜æ›¸ãŸã‚“è¨­å®š</span>
        <span class="close-btn" onclick="toggleOverlayMenu()">Ã—</span>
      </div>
      <div class="overlay-content">
        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘åŸºæœ¬è¨­å®š -->
        <div class="settings-section">
          <div class="slider-control">
            <label>é€æ˜åº¦: <span id="opacityValue">100</span>%</label>
            <input type="range" id="opacitySlider" min="0" max="100" value="100" oninput="updateOpacity(this.value)">
          </div>
          <div class="slider-control">
            <label>ã‚µã‚¤ã‚º: <span id="sizeValue">100</span>%</label>
            <input type="range" id="sizeSlider" min="50" max="150" value="100" oninput="updateSize(this.value)">
          </div>
          <div class="position-control">
            <label>ä½ç½®:</label>
            <div class="position-buttons">
              <button onclick="updatePosition('topLeft')">å·¦ä¸Š</button>
              <button onclick="updatePosition('topRight')">å³ä¸Š</button>
              <button onclick="updatePosition('bottomLeft')">å·¦ä¸‹</button>
              <button onclick="updatePosition('bottomRight')">å³ä¸‹</button>
            </div>
          </div>
          <div class="toggle-control">
            <label>
              <input type="checkbox" id="autoHideToggle" onchange="toggleAutoHide(this.checked)">
              ãƒã‚¦ã‚¹æ“ä½œæ™‚ã«è‡ªå‹•ã§é€æ˜åŒ–
            </label>
          </div>
          <div class="toggle-control">
            <label>
              <input type="checkbox" id="alwaysTopToggle" onchange="toggleAlwaysOnTop(this.checked)">
              å¸¸ã«æœ€å‰é¢ã«è¡¨ç¤º
            </label>
          </div>
        </div>
        
        <!-- é–‹ç™ºè€…å‘ã‘è©³ç´°è¨­å®šï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¼ï¼‰ -->
        <div class="advanced-section-wrapper">
          <div class="advanced-section-toggle" onclick="toggleAdvancedSection()">
            <span class="toggle-icon">â–·</span> è©³ç´°è¨­å®šï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰
          </div>
          <div class="advanced-section" id="advancedSection" style="display: none;">
            <div class="advanced-buttons">
              <button onclick="toggleDebugMenu()">é–‹ç™ºãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
              <button onclick="toggleDebugPanel()">ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«</button>
              <button onclick="openDevTools()">é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«</button>
              <button onclick="testZombieOverlay()">ã‚¾ãƒ³ãƒ“è­¦å‘Šãƒ†ã‚¹ãƒˆ</button>
              <button onclick="testNormalBubble()">å¹ãå‡ºã—çŠ¶æ…‹ç¢ºèª</button>
            </div>
          </div>
        </div>
        
        <div class="overlay-footer">
          <button onclick="saveSettings()" class="save-button">ä¿å­˜</button>
          <button onclick="closeApp()" class="exit-button">çµ‚äº†</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script type="module" src="ui/renderer.js"></script>
  <script>
    // AudioContextã‚’æœ€åˆã®ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’å¾…ãŸãšã«éŸ³å£°ã‚’å†ç”Ÿã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®åˆæœŸåŒ–
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      // ã‚µã‚¤ãƒ¬ãƒ³ãƒˆéŸ³å£°ã‚’å†ç”Ÿã—ã¦åˆæœŸåŒ–
      const silentAudio = new Audio();
      silentAudio.volume = 0.01;
      silentAudio.play().catch(err => console.log('åˆæœŸã‚µã‚¤ãƒ¬ãƒ³ãƒˆå†ç”Ÿï¼š', err));
      
      // ç§˜æ›¸ãŸã‚“ã®ä½ç½®ã‚’å¾©å…ƒ
      restoreImagePosition();
      
      // toggleDragModeé–¢æ•°ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ç¢ºå®Ÿã«å…¬é–‹ï¼ˆäºŒé‡ç¢ºèªï¼‰
      if (typeof window.toggleDragMode !== 'function') {
        console.log('ğŸ”„ DOMContentLoadedã§toggleDragModeé–¢æ•°ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«åŒ–ã—ã¾ã™');
        window.toggleDragMode = toggleDragMode;
      } else {
        console.log('âœ… toggleDragModeé–¢æ•°ã¯æ—¢ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™');
      }
    });
    
    // Electronç’°å¢ƒã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
    const isElectronApp = typeof window !== 'undefined' && 
                          typeof window.electronAPI !== 'undefined';
    
    console.log('ç’°å¢ƒãƒã‚§ãƒƒã‚¯: Electron =', isElectronApp ? 'Yes' : 'No');
    
    // speaké–¢æ•°ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å®šç¾©ï¼ˆrenderer.jsã®ã‚‚ã®ãŒãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
    if (typeof window.speak !== 'function') {
      window.speak = function(text, emotion = 'normal', displayTime = 5000) {
        console.log(`[Fallback] ç§˜æ›¸ãŸã‚“ã®ç™ºè¨€: ${text} (æ„Ÿæƒ…: ${emotion}, è¡¨ç¤ºæ™‚é–“: ${displayTime}ms)`);
        // å¹ãå‡ºã—ã‚’å–å¾—
        const speechBubble = document.getElementById('speechBubble');
        const speechText = document.getElementById('speechText');
        
        if (speechBubble && speechText) {
          // ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®š
          speechText.textContent = text;
          
          // å¹ãå‡ºã—ã‚’è¡¨ç¤º
          speechBubble.style.cssText = `
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
          `;
          speechBubble.className = 'speech-bubble show';
          
          // æŒ‡å®šæ™‚é–“å¾Œã«éè¡¨ç¤º
          if (displayTime > 0) {
            setTimeout(() => {
              speechBubble.className = 'speech-bubble hide';
              speechBubble.style.opacity = '0';
              setTimeout(() => {
                speechBubble.style.display = 'none';
              }, 300);
            }, displayTime);
          }
        }
      };
    }
    
    // ãƒ‡ãƒãƒƒã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
    function toggleDebugMenu() {
      const menu = document.getElementById('debugMenu');
      if (menu.style.display === 'none') {
        menu.style.display = 'flex';
      } else {
        menu.style.display = 'none';
      }
    }
    
    // é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãé–¢æ•°
    function openDevTools() {
      if (window.electronAPI && window.electronAPI.openDevTools) {
        console.log('ElectronAPIçµŒç”±ã§é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãã¾ã™');
        window.electronAPI.openDevTools();
      } else {
        console.log('Electron APIãŒåˆ©ç”¨ã§ããªã„ãŸã‚é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã‘ã¾ã›ã‚“');
        alert('é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãã«ã¯Ctrl+Shift+I (Windows/Linux) ã¾ãŸã¯ Cmd+Option+I (Mac) ã‚’æŠ¼ã—ã¦ãã ã•ã„');
      }
    }
    
    // é€šå¸¸å¹ãå‡ºã—ãƒ†ã‚¹ãƒˆ
    function testNormalBubble() {
      console.log('é€šå¸¸å¹ãå‡ºã—ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ');
      // ç›´æ¥renderer.jsã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™
      window.speak('ã“ã‚Œã¯é€šå¸¸ã®å¹ãå‡ºã—ãƒ†ã‚¹ãƒˆã§ã™', 'normal', 10000);
    }
    
    // èµ¤ã„å¹ãå‡ºã—ãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
    function testBubble() {
      console.log('èµ¤å¹ãå‡ºã—ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ');
      const speechBubble = document.getElementById('speechBubble');
      const speechText = document.getElementById('speechText');
      
      // ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š
      speechText.textContent = 'ã“ã‚Œã¯ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ†ã‚¹ãƒˆã§ã™ï¼';
      
      // å¼·åˆ¶çš„ã«è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ã®èµ¤ã„å¹ãå‡ºã—ï¼‰
      speechBubble.className = 'speech-bubble debug-bubble';
      speechBubble.style.cssText = `
        display: flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        background-color: #ffdddd !important;
        border: 3px solid #d32f2f !important;
        position: fixed !important;
        top: 100px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        z-index: 999999 !important;
      `;
      
      console.log('èµ¤å¹ãå‡ºã—è¨­å®šå®Œäº†');
    }
    
    // ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚’ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã™ã‚‹é–¢æ•°
    function testRandomLine() {
      console.log('ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚’ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã—ã¾ã™');
      
      // ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•é–¢æ•°ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
      if (typeof window.initRandomLines === 'function') {
        // æ—¢å­˜ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½¿ç”¨
        if (window.randomLinesController && typeof window.randomLinesController.showNow === 'function') {
          console.log('æ—¢å­˜ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚’è¡¨ç¤ºã—ã¾ã™');
          window.randomLinesController.showNow();
        } else {
          // æ–°ã—ã„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”Ÿæˆ
          console.log('æ–°ã—ã„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”Ÿæˆã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚’è¡¨ç¤ºã—ã¾ã™');
          const controller = window.initRandomLines(15000);
          
          // å³æ™‚å®Ÿè¡Œ
          if (controller && typeof controller.showNow === 'function') {
            controller.showNow();
          }
        }
      } else if (typeof window.showRandomLine === 'function') {
        // showRandomLineé–¢æ•°ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†
        console.log('âœ… showRandomLineé–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™');
        
        // ç°¡æ˜“ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆ
        window.randomLinesController = {
          showNow: window.showRandomLine,
          stop: function() { console.log('ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚’åœæ­¢ã—ã¾ã—ãŸ'); }
        };
      } else {
        console.error('ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•é–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        alert('ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•æ©Ÿèƒ½ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
      }
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã®å‡¦ç†ã‚’å¼·åŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('DOM èª­ã¿è¾¼ã¿å®Œäº† - åˆæœŸåŒ–é–‹å§‹');
      
      // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®åˆæœŸåŒ–ã‚’å¾…ã¤
      const waitForRandomLines = () => {
        console.log('ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•æ©Ÿèƒ½ã®åˆæœŸåŒ–å‡¦ç†ã‚’é–‹å§‹');
        
        try {
          // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ã‚’ç¢ºèª
          if (typeof window.initRandomLines === 'function') {
            console.log('âœ… ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•é–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ - åˆæœŸåŒ–ã—ã¾ã™');
            try {
              // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
              window.randomLinesController = window.initRandomLines(15000);
              
              // ãƒ†ã‚¹ãƒˆç”¨ã«å³æ™‚å®Ÿè¡Œ
              setTimeout(() => {
                console.log('ğŸ” ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ');
                if (window.randomLinesController && typeof window.randomLinesController.showNow === 'function') {
                  window.randomLinesController.showNow();
                }
              }, 3000);
            } catch (error) {
              console.error('ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
              
              // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«ç°¡æ˜“ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆ
              window.randomLinesController = createFallbackController();
            }
          } else if (typeof window.showRandomLine === 'function') {
            // showRandomLineé–¢æ•°ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†
            console.log('âœ… showRandomLineé–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™');
            
            // ç°¡æ˜“ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆ
            window.randomLinesController = {
              showNow: window.showRandomLine,
              stop: function() { console.log('ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚’åœæ­¢ã—ã¾ã—ãŸ'); }
            };
          } else {
            console.warn('âš ï¸ ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•é–¢æ•°ãŒã¾ã è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆå†è©¦è¡Œã—ã¾ã™ï¼‰');
            // å†è©¦è¡Œ
            setTimeout(waitForRandomLines, 1000);
          }
        } catch (e) {
          console.error('ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', e);
        }
      };
      
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ä½œæˆé–¢æ•°
      function createFallbackController() {
        console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆã—ã¾ã™');
        return {
          showNow: function() {
            const phrases = [
              "ãŠã¤ã‹ã‚Œã•ã¾ã€œâ€¦ãã‚…ã£ã¦ã—ã¦ã‚ã’ãŸã„æ°—åˆ†ãªã®",
              "ã™ã”ã„ã‚ˆâ€¦ã¡ã‚ƒã‚“ã¨é ‘å¼µã£ã¦ã‚‹ã®ã€è¦‹ã¦ã‚‹ã‹ã‚‰ã­",
              "ãµã«ã‚ƒâ€¦ä»Šæ—¥ã¯ã®ã‚“ã³ã‚Šã—ã‚ˆï¼Ÿ",
              "ã­ã‡ã€ã¡ã‚‡ã£ã¨ã ã‘ç”˜ãˆã¦ã‚‚ã„ã„â€¦ï¼Ÿ",
              "ã“ã“ã«ã„ã‚‹ã‹ã‚‰ã­ã€‚ã²ã¨ã‚Šã˜ã‚ƒãªã„ã‚ˆ",
              "ãŠæ°´é£²ã‚“ã ï¼Ÿå°ä¼‘æ†©ã—ã‚ˆã£ã‹",
              "ãˆã‚‰ã„ãˆã‚‰ã„â€¦ã‚ˆã—ã‚ˆã—ã£"
            ];
            const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
            if (typeof window.speak === 'function') {
              window.speak(randomPhrase, 'normal', 5000);
            } else {
              console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™ºè¨€:', randomPhrase);
            }
          },
          stop: function() {
            console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼: ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒªãƒ•ã‚’åœæ­¢ã—ã¾ã—ãŸ');
          }
        };
      }
      
      // 5ç§’å¾Œã«åˆæœŸåŒ–ã‚’é–‹å§‹ï¼ˆãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–ã®æ™‚é–“ã‚’ç¢ºä¿ï¼‰
      setTimeout(waitForRandomLines, 5000);
    });
    
    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    document.addEventListener('keydown', (event) => {
      // Ctrl+Shift+I ã¾ãŸã¯ Cmd+Option+I ã§é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã
      if ((event.ctrlKey || event.metaKey) && event.shiftKey && (event.key === 'I' || event.key === 'i')) {
        openDevTools();
      }
      // F2ã‚­ãƒ¼ã§ãƒ‡ãƒãƒƒã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
      if (event.key === 'F2') {
        toggleDebugMenu();
      }
      
      // F3ã‚­ãƒ¼ã§é€šå¸¸å¹ãå‡ºã—ãƒ†ã‚¹ãƒˆ
      if (event.key === 'F3') {
        testNormalBubble();
      }
      
      // Ctrl+F11 ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
      if ((event.ctrlKey || event.metaKey) && event.key === 'F11') {
        toggleOverlayMenu();
        event.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’é˜²æ­¢
      }

      // Ctrl+Shift+P ã§ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
      if (event.ctrlKey && event.shiftKey && (event.key === 'P' || event.key === 'p')) {
        toggleDragMode();
        event.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’é˜²æ­¢
      }
    });

    // ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
    function toggleDragMode() {
      const body = document.body;
      const isDragMode = body.classList.toggle('drag-mode-enabled');
      
      console.log('ğŸ¾ toggleDragModeé–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸï¼isDragMode:', isDragMode);
      // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆãƒ†ã‚¹ãƒˆå¾Œã«å‰Šé™¤ã—ã¦ãã ã•ã„ï¼‰
      alert('ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ğŸ¾ ' + (isDragMode ? 'ON' : 'OFF'));
      
      if (isDragMode) {
        console.log('ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–');
        initDraggable();
        if (typeof speak === 'function') {
          speak('ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã—ã¾ã—ãŸã€‚ç§˜æ›¸ãŸã‚“ã‚’å¥½ããªä½ç½®ã«ç§»å‹•ã§ãã¾ã™ã€‚', 'normal', 3000);
        }
      } else {
        console.log('ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ç„¡åŠ¹åŒ–');
        if (typeof speak === 'function') {
          speak('ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹ã«ã—ã¾ã—ãŸã€‚', 'normal', 3000);
        }
        
        // ä½ç½®æƒ…å ±ã‚’ä¿å­˜
        saveImagePosition();
      }
    }

    // ç¢ºå®Ÿã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«å…¬é–‹
    window.toggleDragMode = toggleDragMode;

    // ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½ã®åˆæœŸåŒ–
    function initDraggable() {
      const img = document.getElementById('assistantImage');
      const container = document.querySelector('.assistant-container');
      
      if (!img || !container) return;
      
      // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹æ™‚ã®ä½ç½®æƒ…å ±
      let dragStartX = 0;
      let dragStartY = 0;
      let imgStartLeft = 0;
      let imgStartTop = 0;
      
      // ãƒã‚¦ã‚¹ãƒ€ã‚¦ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
      img.addEventListener('mousedown', startDrag);
      
      function startDrag(e) {
        e.preventDefault();
        
        // ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
        if (!document.body.classList.contains('drag-mode-enabled')) return;
        
        // ç¾åœ¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å–å¾—
        const style = window.getComputedStyle(img);
        
        // ç”»åƒã®ç¾åœ¨ä½ç½®
        const left = parseInt(img.style.left) || 0;
        const top = parseInt(img.style.top) || 0;
        
        // ãƒã‚¦ã‚¹æŠ¼ä¸‹ä½ç½®
        dragStartX = e.clientX;
        dragStartY = e.clientY;
        imgStartLeft = left;
        imgStartTop = top;
        
        // ç”»åƒã«ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
        img.style.cursor = 'grabbing';
        
        // ãƒã‚¦ã‚¹ç§»å‹•ã¨ãƒã‚¦ã‚¹ã‚¢ãƒƒãƒ—ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
        document.addEventListener('mousemove', dragMove);
        document.addEventListener('mouseup', dragEnd);
      }
      
      function dragMove(e) {
        e.preventDefault();
        
        // ãƒã‚¦ã‚¹ã®ç§»å‹•é‡ã‚’è¨ˆç®—
        const dx = e.clientX - dragStartX;
        const dy = e.clientY - dragStartY;
        
        // æ–°ã—ã„ä½ç½®ã‚’è¨ˆç®—
        const newLeft = imgStartLeft + dx;
        const newTop = imgStartTop + dy;
        
        // ä½ç½®ã‚’æ›´æ–°
        img.style.position = 'absolute';
        img.style.left = `${newLeft}px`;
        img.style.top = `${newTop}px`;
      }
      
      function dragEnd() {
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
        document.removeEventListener('mousemove', dragMove);
        document.removeEventListener('mouseup', dragEnd);
        
        // ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å…ƒã«æˆ»ã™
        img.style.cursor = 'grab';
        
        // ä½ç½®ä¿å­˜
        saveImagePosition();
      }
    }
    
    // ä½ç½®æƒ…å ±ã®ä¿å­˜
    function saveImagePosition() {
      const img = document.getElementById('assistantImage');
      if (!img) return;
      
      const left = parseInt(img.style.left) || 0;
      const top = parseInt(img.style.top) || 0;
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
      localStorage.setItem('secretaryImagePosition', JSON.stringify({ left, top }));
      console.log(`ç§˜æ›¸ãŸã‚“ã®ä½ç½®ã‚’ä¿å­˜ã—ã¾ã—ãŸ: left=${left}, top=${top}`);
    }
    
    // ä½ç½®æƒ…å ±ã®å¾©å…ƒ
    function restoreImagePosition() {
      const img = document.getElementById('assistantImage');
      if (!img) return;
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
      const positionStr = localStorage.getItem('secretaryImagePosition');
      if (!positionStr) return;
      
      try {
        const position = JSON.parse(positionStr);
        if (typeof position.left === 'number' && typeof position.top === 'number') {
          // ä½ç½®ã‚’è¨­å®š
          img.style.position = 'absolute';
          img.style.left = `${position.left}px`;
          img.style.top = `${position.top}px`;
          console.log(`ç§˜æ›¸ãŸã‚“ã®ä½ç½®ã‚’å¾©å…ƒã—ã¾ã—ãŸ: left=${position.left}, top=${position.top}`);
        }
      } catch (error) {
        console.error('ä½ç½®æƒ…å ±ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
      }
    }
  </script>

  <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
  <div id="debug-panel" style="display: none; position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; z-index: 9999999; font-family: monospace; font-size: 12px;">
    <div style="margin-bottom: 8px;">
      <button id="testZombieWarningBtn" style="background: #f44336; color: white; border: none; padding: 5px 10px; margin-right: 5px; cursor: pointer;">ã‚¾ãƒ³ãƒ“è­¦å‘Šãƒ†ã‚¹ãƒˆ</button>
      <button id="checkBubbleBtn" style="background: #2196f3; color: white; border: none; padding: 5px 10px; cursor: pointer;">å¹ãå‡ºã—çŠ¶æ…‹ç¢ºèª</button>
    </div>
    <div id="debug-info" style="max-width: 300px; max-height: 200px; overflow: auto; background: rgba(0,0,0,0.5); padding: 5px; margin-top: 5px; display: none;"></div>
  </div>

  <script>
    // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿æ™‚ã«ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º/éè¡¨ç¤º
    document.addEventListener('DOMContentLoaded', () => {
      const debugPanel = document.getElementById('debug-panel');
      
      // Alt+Cã®ã‚¤ãƒ™ãƒ³ãƒˆã¯renderer.jsã§å‡¦ç†ã™ã‚‹ãŸã‚å‰Šé™¤
      
      // ã‚¾ãƒ³ãƒ“è­¦å‘Šãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³
      document.getElementById('testZombieWarningBtn').addEventListener('click', () => {
        // WebSocketã®sendMessageé–¢æ•°ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
        if (typeof window.sendMessage === 'function') {
          window.sendMessage({
            type: 'zombie_warning',
            data: { count: 3 }
          });
        } else {
          console.error('sendMessageé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          window.alert('sendMessageé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚WebSocketãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        }
      });
      
      // å¹ãå‡ºã—çŠ¶æ…‹ç¢ºèªãƒœã‚¿ãƒ³
      document.getElementById('checkBubbleBtn').addEventListener('click', () => {
        const bubble = document.getElementById('speechBubble');
        const debugInfo = document.getElementById('debug-info');
        
        if (bubble && debugInfo) {
          const computed = window.getComputedStyle(bubble);
          debugInfo.style.display = 'block';
          debugInfo.innerHTML = `
            <div>ã‚¯ãƒ©ã‚¹: ${bubble.className}</div>
            <div>display: ${computed.display}</div>
            <div>visibility: ${computed.visibility}</div>
            <div>opacity: ${computed.opacity}</div>
            <div>z-index: ${computed.zIndex}</div>
            <div>position: ${computed.position}</div>
          `;
        } else {
          debugInfo.innerHTML = 'å¹ãå‡ºã—è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
        }
      });
    });
  </script>

  <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ãƒˆã‚°ãƒ«é–¢æ•°è¿½åŠ  -->
  <script>
    function toggleDebugPanel() {
      const panel = document.getElementById('debug-panel');
      if (panel.style.display === 'none') {
        panel.style.display = 'block';
        const infoPanel = document.getElementById('debug-info');
        if (infoPanel) {
          infoPanel.style.display = 'block';
        }
      } else {
        panel.style.display = 'none';
      }
    }
  </script>

  <script>
    // ãƒ†ã‚¹ãƒˆç”¨: ã‚¾ãƒ³ãƒ“ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ãƒ†ã‚¹ãƒˆ
    function testZombieOverlay() {
      // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
      if (window.zombieOverlayManager) {
        console.log('ã‚¾ãƒ³ãƒ“ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™');
        window.zombieOverlayManager.testOverlay();
      } else {
        console.error('ã‚¾ãƒ³ãƒ“ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        alert('ã‚¾ãƒ³ãƒ“ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
      }
    }
  </script>

  <script>
    // è©³ç´°è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
    function toggleAdvancedSection() {
      const section = document.getElementById('advancedSection');
      const toggle = document.querySelector('.advanced-section-toggle');
      
      if (section.style.display === 'none') {
        section.style.display = 'block';
        toggle.querySelector('.toggle-icon').textContent = 'â–¼';
      } else {
        section.style.display = 'none';
        toggle.querySelector('.toggle-icon').textContent = 'â–·';
      }
    }
  </script>
</body>
</html> 